<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>í•œêµ­ì£¼ì‹ í€€íŠ¸ ëŒ€ì‹œë³´ë“œ</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f1a2e; --panel2:#0c1628; --line:rgba(148,163,184,.18);
      --txt:#e5e7eb; --muted:#94a3b8; --good:#34d399; --bad:#fb7185; --warn:#fbbf24;
      --accent:#60a5fa; --radius:16px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; font-family: sans-serif; background: var(--bg); color:var(--txt); overflow-x:hidden;
    }
    .app{ display:flex; flex-direction:column; min-height:100vh; }
    .topbar{ padding: 14px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid var(--line); }
    .brand{ display:flex; align-items:center; gap:10px; }
    .logo{ width:30px; height:30px; border-radius:8px; background: linear-gradient(135deg, #60a5fa, #34d399); }
    .main{ flex:1; padding: 20px; }
    
    /* ì¹´ë“œ ìŠ¤íƒ€ì¼ ê°œì„  */
    .grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:12px; margin-bottom:20px; }
    .card{ 
      border:1px solid var(--line); background: var(--panel); border-radius: var(--radius); 
      padding: 15px; cursor: pointer; transition: 0.2s; position:relative;
    }
    .card:hover{ transform: translateY(-3px); border-color: var(--accent); }
    .card .k{ font-size:12px; color:var(--muted); display:flex; justify-content:space-between; }
    .card .v{ margin-top:10px; font-size:24px; font-weight:900; }
    
    /* ì‹œê·¸ë„ ë°°ì§€ ìƒ‰ìƒ */
    .badge-breakout { background: rgba(251, 113, 133, 0.2) !important; color: #fb7185 !important; border: 1px solid rgba(251, 113, 133, 0.4) !important; }
    .badge-pullback { background: rgba(251, 191, 36, 0.2) !important; color: #fbbf24 !important; border: 1px solid rgba(251, 191, 36, 0.4) !important; }
    .badge-trend { background: rgba(52, 211, 153, 0.2) !important; color: #34d399 !important; border: 1px solid rgba(52, 211, 153, 0.4) !important; }
    
    /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    .panel{ background: var(--panel2); border-radius: var(--radius); border: 1px solid var(--line); overflow:hidden; }
    .panelHead{ padding: 15px; border-bottom: 1px solid var(--line); display:flex; justify-content:space-between; }
    .tableScroll{ overflow-x:auto; width:100%; }
    table{ width:100%; border-collapse:collapse; font-size:13px; min-width:800px; }
    th{ background: rgba(0,0,0,0.2); color: var(--muted); padding: 12px; text-align:left; position: sticky; top:0; }
    td{ padding: 12px; border-bottom: 1px solid var(--line); white-space:nowrap; }
    .numRight{ text-align:right; font-family: monospace; }
    .center{ text-align:center; }
    .pill{ padding: 4px 10px; border-radius: 999px; font-size:11px; font-weight:bold; cursor:pointer; background: rgba(255,255,255,0.05); }
    .pill.on{ background: var(--accent); color: white; }
    .btn{ padding: 8px 16px; border-radius: 8px; border:1px solid var(--line); background: var(--panel); color:var(--txt); cursor:pointer; }
  </style>
</head>
<body>
<div class="app">
  <div class="topbar">
    <div class="brand"><div class="logo"></div><div><b id="screenTitle">í€€íŠ¸ ëŒ€ì‹œë³´ë“œ</b><div style="font-size:11px; color:var(--muted)" id="statusLine">ëŒ€ê¸° ì¤‘...</div></div></div>
    <div><button class="btn" id="btnRefresh">ë°ì´í„° ê°±ì‹ </button></div>
  </div>
  
  <div class="main">
    <div class="tabbar" style="margin-bottom:15px; display:flex; gap:10px;">
      <button class="pill on" id="tabScreen">ğŸ” í¬ì°©</button>
      <button class="pill" id="tabPerf">ğŸ“Š ì„±ê³¼</button>
    </div>

    <section id="screenView">
      <div class="grid">
        <div class="card" onclick="switchList('ALL')"><div class="k">ì „ì²´ í¬ì°© ğŸ”</div><div class="v" id="statAll">-</div></div>
        <div class="card" onclick="switchList('TREND')"><div class="k">ì¶”ì„¸ ì¶”ì¢… ğŸ“ˆ</div><div class="v" id="statTrend">-</div></div>
        <div class="card" onclick="switchList('PULLBACK')"><div class="k">ëˆŒë¦¼ëª© ğŸŸ¡</div><div class="v" id="statPullback">-</div></div>
        <div class="card" onclick="switchList('BREAKOUT')"><div class="k">ë°•ìŠ¤ê¶Œ ëŒíŒŒ ğŸš€</div><div class="v" id="statBreakout">-</div></div>
      </div>
      <div class="panel">
        <div class="panelHead"><h3 id="listTitle">ì¢…ëª© ë¦¬ìŠ¤íŠ¸ (ALL)</h3><div id="screenCount">0ê±´</div></div>
        <div class="tableScroll">
          <table>
            <thead><tr><th>ì½”ë“œ</th><th>ì¢…ëª©ëª…</th><th class="numRight">í˜„ì¬ê°€</th><th class="numRight">ê±°ë˜ëŒ€ê¸ˆ</th><th class="numRight">RSI14</th><th class="numRight">Stoch K</th><th class="center">ì‹œê·¸ë„</th></tr></thead>
            <tbody id="screenTbody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="perfView" style="display:none;">
      <div class="panel">
        <div class="panelHead"><h3>ì„±ê³¼ ì¸¡ì • (ìµœê·¼ í¬ì°© ê¸°ì¤€)</h3></div>
        <div class="tableScroll">
          <table>
            <thead><tr><th>í¬ì°©ì¼</th><th>ì½”ë“œ</th><th>ì¢…ëª©ëª…</th><th class="numRight">ì§„ì…ê°€</th><th class="numRight">í˜„ì¬ê°€</th><th class="numRight">ìˆ˜ìµë¥ </th><th class="numRight">D1</th><th class="numRight">D3</th><th class="numRight">D5</th><th class="numRight">D7</th><th class="numRight">D9</th></tr></thead>
            <tbody id="perfTbody"></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>
</div>

<script>
const URLS = {
  ALL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=0&single=true&output=csv",
  TREND: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=1981708246&single=true&output=csv",
  PULLBACK: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=852505203&single=true&output=csv",
  BREAKOUT: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=258627301&single=true&output=csv",
  STORAGE: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=2034892211&single=true&output=csv"
};

let data = { ALL:[], TREND:[], PULLBACK:[], BREAKOUT:[], STORAGE:[] };
let currentMode = 'ALL';

function fmt(n) { 
  const x = parseFloat(String(n).replace(/,/g, ""));
  return isNaN(x) ? "-" : x.toLocaleString("ko-KR"); 
}
function fmt2(n) { 
  const x = parseFloat(n);
  return isNaN(x) ? "-" : x.toFixed(2); 
}
function pct(v) {
  const x = parseFloat(String(v).replace('%',''));
  if(isNaN(x)) return "-";
  const cls = x >= 0 ? 'style="color:#34d399"' : 'style="color:#fb7185"';
  return `<span ${cls}>${x.toFixed(2)}%</span>`;
}

function getBadge(r) {
  let cls = ""; let label = "";
  if(String(r.Trend).toLowerCase()==="true") { cls="badge-trend"; label="ì¶”ì„¸"; }
  if(String(r.Pullback).toLowerCase()==="true") { cls="badge-pullback"; label="ëˆŒë¦¼"; }
  if(String(r.Breakout).toLowerCase()==="true") { cls="badge-breakout"; label="ëŒíŒŒ"; }
  return `<span class="pill ${cls}">${label || 'ê´€ë§'}</span>`;
}

async function load() {
  document.getElementById('statusLine').textContent = "ê°±ì‹  ì¤‘...";
  try {
    for(let key in URLS) {
      const res = await fetch(URLS[key] + "&ts=" + Date.now());
      const text = await res.text();
      data[key] = parseCSV(text);
    }
    render();
    document.getElementById('statusLine').textContent = "ìµœì¢… ê°±ì‹ : " + new Date().toLocaleTimeString();
  } catch(e) { alert("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨"); }
}

function parseCSV(text) {
  const rows = text.split('\n').map(r => r.split(','));
  const header = rows.shift().map(h => h.trim());
  return rows.filter(r => r.length > 1).map(r => {
    let obj = {}; header.forEach((h, i) => obj[h] = r[i]?.trim());
    return obj;
  });
}

function render() {
  document.getElementById('statAll').textContent = data.ALL.length;
  document.getElementById('statTrend').textContent = data.TREND.length;
  document.getElementById('statPullback').textContent = data.PULLBACK.length;
  document.getElementById('statBreakout').textContent = data.BREAKOUT.length;
  
  const list = data[currentMode];
  document.getElementById('listTitle').textContent = `ì¢…ëª© ë¦¬ìŠ¤íŠ¸ (${currentMode})`;
  document.getElementById('screenCount').textContent = list.length + "ê±´";
  
  document.getElementById('screenTbody').innerHTML = list.map(r => `
    <tr>
      <td>${r.Code}</td><td><b>${r.Name}</b></td>
      <td class="numRight">${fmt(r.Close)}</td>
      <td class="numRight">${fmt(r.Turnover)}</td>
      <td class="numRight">${fmt2(r.RSI14)}</td>
      <td class="numRight">${fmt2(r.Stoch_K)}</td>
      <td class="center">${getBadge(r)}</td>
    </tr>
  `).join('');

  document.getElementById('perfTbody').innerHTML = data.STORAGE.slice().reverse().map(r => `
    <tr>
      <td style="color:var(--muted)">${(r.DetectDate || "").split(' ')[0]}</td>
      <td>${r.Code}</td><td><b>${r.Name}</b></td>
      <td class="numRight">${fmt(r.EntryPrice)}</td>
      <td class="numRight">${fmt(r.Close_Today)}</td>
      <td class="numRight">${pct(r.Return)}</td>
      <td class="numRight">${pct(r.D1)}</td>
      <td class="numRight">${pct(r.D3)}</td>
      <td class="numRight">${pct(r.D5)}</td>
      <td class="numRight">${pct(r.D7)}</td>
      <td class="numRight">${pct(r.D9)}</td>
    </tr>
  `).join('');
}

function switchList(mode) { currentMode = mode; render(); }
document.getElementById('tabScreen').onclick = () => {
  document.getElementById('screenView').style.display = 'block';
  document.getElementById('perfView').style.display = 'none';
  document.getElementById('tabScreen').classList.add('on');
  document.getElementById('tabPerf').classList.remove('on');
};
document.getElementById('tabPerf').onclick = () => {
  document.getElementById('screenView').style.display = 'none';
  document.getElementById('perfView').style.display = 'block';
  document.getElementById('tabPerf').classList.add('on');
  document.getElementById('tabScreen').classList.remove('on');
};
document.getElementById('btnRefresh').onclick = load;
window.onload = load;
</script>
</body>
</html>
