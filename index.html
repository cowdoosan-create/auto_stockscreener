<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>í•œêµ­ì£¼ì‹ í€€íŠ¸ ëŒ€ì‹œë³´ë“œ</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f1a2e; --panel2:#0c1628; --line:rgba(148,163,184,.18);
      --txt:#e5e7eb; --muted:#94a3b8; --good:#34d399; --bad:#fb7185; --warn:#fbbf24;
      --accent:#60a5fa; --radius:16px;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family: sans-serif; background: var(--bg); color:var(--txt); overflow-x:hidden; }
    .app{ display:flex; flex-direction:column; min-height:100vh; }
    
    /* [ê°œì„ ] íƒ­ ë²„íŠ¼ ì‹œì¸ì„± ê°•í™” */
    .tabbar { margin: 20px 0; display: flex; gap: 15px; padding: 0 20px; }
    .tab-btn { 
      padding: 12px 30px; border-radius: 12px; border: 2px solid var(--line);
      background: var(--panel); color: var(--muted); font-size: 16px; font-weight: 900;
      cursor: pointer; transition: all 0.3s;
    }
    .tab-btn.on { 
      background: var(--accent); color: #fff; border-color: var(--accent);
      box-shadow: 0 4px 15px rgba(96, 165, 250, 0.4);
    }

    .main{ flex:1; padding: 0 20px 20px 20px; }
    .grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:15px; margin-bottom:25px; }
    .card{ 
      border:1px solid var(--line); background: var(--panel); border-radius: var(--radius); 
      padding: 20px; cursor: pointer; transition: 0.2s;
    }
    .card:hover{ transform: translateY(-5px); border-color: var(--accent); }
    .card .v{ margin-top:12px; font-size:28px; font-weight:900; }
    
    /* ì‹œê·¸ë„ ë°°ì§€ ìŠ¤íƒ€ì¼ */
    .badge-sig { padding: 4px 12px; border-radius: 8px; font-size: 12px; font-weight: bold; margin-right: 4px; display: inline-block; }
    .sig-trend { background: rgba(52, 211, 153, 0.2); color: #34d399; }
    .sig-pullback { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
    .sig-breakout { background: rgba(251, 113, 133, 0.2); color: #fb7185; }
    
    .panel{ background: var(--panel2); border-radius: var(--radius); border: 1px solid var(--line); overflow:hidden; }
    .panelHead{ padding: 20px; border-bottom: 1px solid var(--line); display:flex; justify-content:space-between; align-items:center; }
    table{ width:100%; border-collapse:collapse; font-size:14px; min-width:900px; }
    th{ background: rgba(255,255,255,0.03); color: var(--muted); padding: 15px; text-align:left; font-weight: 600; }
    td{ padding: 15px; border-bottom: 1px solid var(--line); }
    .numRight{ text-align:right; font-family: 'Roboto Mono', monospace; }
    .btn-refresh{ padding: 10px 20px; border-radius: 10px; background: var(--good); color: #000; font-weight: bold; border: none; cursor: pointer; }
  </style>
</head>
<body>
<div class="app">
  <div style="padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--line);">
    <div><b style="font-size: 20px;">K-Stock Quant Dashboard</b> <span id="statusLine" style="font-size: 12px; color: var(--muted); margin-left: 10px;"></span></div>
    <button class="btn-refresh" id="btnRefresh">ë°ì´í„° ê°±ì‹ </button>
  </div>

  <div class="tabbar">
    <button class="tab-btn on" id="tabScreen">ğŸ” í¬ì°© ì¢…ëª©</button>
    <button class="tab-btn" id="tabPerf">ğŸ“Š ì„±ê³¼ ì¸¡ì •</button>
  </div>
  
  <div class="main">
    <section id="screenView">
      <div class="grid">
        <div class="card" onclick="switchList('ALL')"><div class="k">ì „ì²´ í¬ì°©</div><div class="v" id="statAll">-</div></div>
        <div class="card" onclick="switchList('TREND')"><div class="k">ì¶”ì„¸ ì¶”ì¢…</div><div class="v" id="statTrend">-</div></div>
        <div class="card" onclick="switchList('PULLBACK')"><div class="k">ëˆŒë¦¼ëª©</div><div class="v" id="statPullback">-</div></div>
        <div class="card" onclick="switchList('BREAKOUT')"><div class="k">ë°•ìŠ¤ê¶Œ ëŒíŒŒ</div><div class="v" id="statBreakout">-</div></div>
      </div>
      <div class="panel">
        <div class="panelHead"><h3 id="listTitle" style="margin:0;">ë¦¬ìŠ¤íŠ¸ (ALL)</h3><div id="screenCount">0ê±´</div></div>
        <div style="overflow-x:auto;">
          <table>
            <thead><tr><th>ì½”ë“œ</th><th>ì¢…ëª©ëª…</th><th class="numRight">í˜„ì¬ê°€</th><th class="numRight">ê±°ë˜ëŒ€ê¸ˆ</th><th class="numRight">RSI14</th><th class="numRight">Stoch K</th><th style="text-align:center;">ì‹œê·¸ë„</th></tr></thead>
            <tbody id="screenTbody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="perfView" style="display:none;">
      <div class="panel">
        <div class="panelHead"><h3 style="margin:0;">í¬ì°©ì¼ë³„ ì„±ê³¼ ì¶”ì </h3></div>
        <div style="overflow-x:auto;">
          <table>
            <thead><tr><th>í¬ì°©ì¼</th><th>ì½”ë“œ</th><th>ì¢…ëª©ëª…</th><th class="numRight">í¬ì°©ê°€</th><th class="numRight">í˜„ì¬ê°€</th><th class="numRight">ìˆ˜ìµë¥ </th><th class="numRight">D1(ë‹¹ì¼)</th><th class="numRight">D3</th><th class="numRight">D5</th><th class="numRight">D7</th><th class="numRight">D9</th></tr></thead>
            <tbody id="perfTbody"></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>
</div>

<script>
const URLS = {
  ALL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=0&single=true&output=csv",
  TREND: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=1981708246&single=true&output=csv",
  PULLBACK: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=852505203&single=true&output=csv",
  BREAKOUT: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=258627301&single=true&output=csv",
  STORAGE: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=2034892211&single=true&output=csv"
};

let data = { ALL:[], TREND:[], PULLBACK:[], BREAKOUT:[], STORAGE:[] };
let currentMode = 'ALL';

// [ê°œì„ ] ê°€ê²© í¬ë§·: ì½¤ë§ˆ + "ì›"
function fmtPrice(n) {
  const x = parseFloat(String(n).replace(/,/g, ""));
  return isNaN(x) ? "-" : x.toLocaleString() + "ì›";
}

// [ê°œì„ ] ê±°ë˜ëŒ€ê¸ˆ í¬ë§·: "ì–µì›" ë‹¨ìœ„
function fmtTurnover(n) {
  const x = parseFloat(String(n).replace(/,/g, ""));
  if(isNaN(x)) return "-";
  return Math.floor(x / 100000000).toLocaleString() + "ì–µ";
}

function fmt2(n) { const x = parseFloat(n); return isNaN(x) ? "-" : x.toFixed(2); }

function pct(v) {
  const x = parseFloat(String(v).replace('%',''));
  if(isNaN(x)) return "-";
  const color = x >= 0 ? '#34d399' : '#fb7185';
  return `<span style="color:${color}; font-weight:bold;">${x.toFixed(2)}%</span>`;
}

// [ê°œì„ ] ë³µìˆ˜ ì‹œê·¸ë„ í‘œê¸° ë¡œì§
function getBadges(r) {
  let html = "";
  if(String(r.Trend).toLowerCase()==="true") html += '<span class="badge-sig sig-trend">ì¶”ì„¸</span>';
  if(String(r.Pullback).toLowerCase()==="true") html += '<span class="badge-sig sig-pullback">ëˆŒë¦¼</span>';
  if(String(r.Breakout).toLowerCase()==="true") html += '<span class="badge-sig sig-breakout">ëŒíŒŒ</span>';
  return html || '<span class="badge-sig" style="background:rgba(255,255,255,0.1);">ê´€ë§</span>';
}

async function load() {
  document.getElementById('statusLine').textContent = "ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
  try {
    for(let key in URLS) {
      const res = await fetch(URLS[key] + "&ts=" + Date.now());
      const text = await res.text();
      data[key] = parseCSV(text);
    }
    render();
    document.getElementById('statusLine').textContent = "ìµœì¢… ë™ê¸°í™”: " + new Date().toLocaleTimeString();
  } catch(e) { console.error(e); }
}

function parseCSV(text) {
  const rows = text.split('\n').map(r => r.split(','));
  const header = rows.shift().map(h => h.trim());
  return rows.filter(r => r.length > 1).map(r => {
    let obj = {}; header.forEach((h, i) => obj[h] = r[i]?.trim());
    return obj;
  });
}

function render() {
  document.getElementById('statAll').textContent = data.ALL.length;
  document.getElementById('statTrend').textContent = data.TREND.length;
  document.getElementById('statPullback').textContent = data.PULLBACK.length;
  document.getElementById('statBreakout').textContent = data.BREAKOUT.length;
  
  const list = data[currentMode];
  document.getElementById('listTitle').textContent = `ì¢…ëª© ë¦¬ìŠ¤íŠ¸ (${currentMode})`;
  document.getElementById('screenCount').textContent = list.length + "ê±´";
  
  document.getElementById('screenTbody').innerHTML = list.map(r => `
    <tr>
      <td style="color:var(--muted)">${r.Code}</td><td><b>${r.Name}</b></td>
      <td class="numRight">${fmtPrice(r.Close)}</td>
      <td class="numRight">${fmtTurnover(r.Turnover)}</td>
      <td class="numRight">${fmt2(r.RSI14)}</td>
      <td class="numRight">${fmt2(r.Stoch_K)}</td>
      <td style="text-align:center;">${getBadges(r)}</td>
    </tr>
  `).join('');

  document.getElementById('perfTbody').innerHTML = data.STORAGE.slice().reverse().map(r => `
    <tr>
      <td style="color:var(--muted)">${(r.DetectDate || "").split(' ')[0]}</td>
      <td>${r.Code}</td><td><b>${r.Name}</b></td>
      <td class="numRight">${fmtPrice(r.EntryPrice)}</td>
      <td class="numRight">${fmtPrice(r.Close_Today)}</td>
      <td class="numRight">${pct(r.Return)}</td>
      <td class="numRight">${pct(r.D1)}</td>
      <td class="numRight">${pct(r.D3)}</td>
      <td class="numRight">${pct(r.D5)}</td>
      <td class="numRight">${pct(r.D7)}</td>
      <td class="numRight">${pct(r.D9)}</td>
    </tr>
  `).join('');
}

function switchList(mode) { currentMode = mode; render(); }
document.getElementById('tabScreen').onclick = () => {
  document.getElementById('screenView').style.display = 'block';
  document.getElementById('perfView').style.display = 'none';
  document.getElementById('tabScreen').classList.add('on');
  document.getElementById('tabPerf').classList.remove('on');
};
document.getElementById('tabPerf').onclick = () => {
  document.getElementById('screenView').style.display = 'none';
  document.getElementById('perfView').style.display = 'block';
  document.getElementById('tabPerf').classList.add('on');
  document.getElementById('tabScreen').classList.remove('on');
};
document.getElementById('btnRefresh').onclick = load;
window.onload = load;
</script>
</body>
</html>
